<!DOCTYPE html>
<html>
  <head>
    <title>sparks-bigfire</title>
    <meta
      name="viewport"
      id="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"
    />
    <meta charset="utf-8" />
    <style type="text/css">
      body {
        font-family: Monospace;
        background-color: #f0f0f0;
        margin: 0px;
        overflow: hidden;
      }

      #canvas {
        background: #000000;
      }
    </style>
  </head>

  <body>
    <canvas id="canvas"></canvas>
    <script src="../../lib/info.js"></script>
    <script src="../../lib/stats.min.js"></script>
    <script src="../../lib/proton.min.js"></script>
    <script>
      var canvas;
      var context;
      var proton;
      var renderer;
      var emitter;
      var stats;

      main();

      function main() {
        canvas = document.getElementById("canvas");
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        context = canvas.getContext("2d");
        context.globalCompositeOperation = "lighter";

        addStats();
        loadImage();

        appendInfo(
          "https://codesandbox.io/s/proton-bigfire-rst93?fontsize=14&module=%2Fsrc%2Fcomponents%2FParticles.jsx",
          "https://github.com/a-jie/Proton/blob/master/example/sparks/bigfire/bigfire.html"
        );
      }

      function addStats() {
        stats = new Stats();
        stats.setMode(2);

        stats.domElement.style.position = "absolute";
        stats.domElement.style.left = "0px";
        stats.domElement.style.top = "0px";
        document.body.appendChild(stats.domElement);
      }

      function loadImage() {
        var image = new Image();
        image.onload = function(e) {
          createProton(e.target);
          tick();
        };
        image.src = "image/fire.png";
      }

      function createProton(image) {
        proton = new Proton();
        emitter = new Proton.Emitter();
        emitter.rate = new Proton.Rate(new Proton.Span(5, 13), 0.1);

        emitter.addInitialize(new Proton.Mass(1));
        emitter.addInitialize(new Proton.Body(image));
        emitter.addInitialize(
          new Proton.P(
            new Proton.CircleZone(canvas.width / 2, canvas.height / 2 + 200, 10)
          )
        );
        emitter.addInitialize(new Proton.Life(5, 7));
        emitter.addInitialize(
          new Proton.V(
            new Proton.Span(2, 3),
            new Proton.Span(0, 30, true),
            "polar"
          )
        );

        emitter.addBehaviour(new Proton.Scale(1, 0.2));
        emitter.addBehaviour(new Proton.Alpha(1, 0.2));
        emitter.emit();
        proton.addEmitter(emitter);

        renderer = new Proton.CanvasRenderer(canvas);
        proton.addRenderer(renderer);
      }

      function tick() {
        requestAnimationFrame(tick);

        stats.begin();
        proton.update();
        stats.end();
      }
    </script>
  </body>
</html>
